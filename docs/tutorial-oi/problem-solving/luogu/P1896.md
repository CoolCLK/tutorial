---
sidebar_position: 1896
sidebar_label: 'P1896'
title: 'äº’ä¸ä¾µçŠ¯'
---
import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';

:::info

æ­¤é¢˜ç›®æ¥è‡ª [æ´›è°·](https://www.luogu.com.cn/)ï¼Œ
åŸå§‹é¢˜ç›®ä¸æäº¤ä»£ç è¯·å‰å¾€ [P1896 \[SCOI2005\] äº’ä¸ä¾µçŠ¯ - æ´›è°·](https://www.luogu.com.cn/problem/P1896)ã€‚

:::

### é¢˜ç›®æè¿°

åœ¨ ${N}\times{N}$ çš„æ£‹ç›˜é‡Œé¢æ”¾ $K$ ä¸ªå›½ç‹ï¼Œä½¿ä»–ä»¬äº’ä¸æ”»å‡»ï¼Œå…±æœ‰å¤šå°‘ç§æ‘†æ”¾æ–¹æ¡ˆã€‚å›½ç‹èƒ½æ”»å‡»åˆ°å®ƒä¸Šä¸‹å·¦å³ï¼Œä»¥åŠå·¦ä¸Šå·¦ä¸‹å³ä¸Šå³ä¸‹å…«ä¸ªæ–¹å‘ä¸Šé™„è¿‘çš„å„ä¸€ä¸ªæ ¼å­ï¼Œå…± $8$ ä¸ªæ ¼å­ã€‚

### è¾“å…¥æ ¼å¼

åªæœ‰ä¸€è¡Œï¼ŒåŒ…å«ä¸¤ä¸ªæ•° $N,K$ã€‚

### è¾“å‡ºæ ¼å¼

æ‰€å¾—çš„æ–¹æ¡ˆæ•°

### è¾“å…¥è¾“å‡ºæ ·ä¾‹

è¾“å…¥ #1
```
3 2
```

è¾“å‡º #1
```
16
```

### è¯´æ˜/æç¤º

å¯¹äºå…¨éƒ¨æ•°æ®ï¼Œ${1}\le{N}\le{9}$ï¼Œ${0}\le{K}\le{{N}\times{N}}$ã€‚

### é¢˜ç›®è§£ç­”

è¿™æ˜¯ä¸€é“ååˆ†ç»å…¸çš„çŠ¶å‹ DP çš„é¢˜ç›®ã€‚
æ—¢ç„¶å®ƒæ˜¯ä¸€é“åŠ¨æ€è§„åˆ’çš„é¢˜ç›®ï¼Œå…ä¸äº†çŠ¶æ€è½¬ç§»æ–¹ç¨‹ã€‚

#### ä½è¿ç®—

æœ¬é¢˜è§£æ¶‰åŠåˆ°äº†ä½è¿ç®— `&`ã€`|`ã€`>>`ã€`<<`ã€‚

`&` çš„ä½œç”¨æ˜¯åªè®©ä¸¤ä¸ªæ•°æ®éƒ½æœ‰ `1` çš„ä½ç½®è¾“å‡º `1`ã€‚
æ¯”å¦‚è¯´ `0 & 0 = 0`ã€`0 & 1 = 0`ã€`1 & 0 = 0`ã€`1 & 1 = 1`ã€‚

`|` çš„ä½œç”¨æ˜¯è®©å…¶ä¸­ä¸€ä¸ªæ•°æ®æœ‰ `1` çš„ä½ç½®è¾“å‡º `1`ã€‚
æ¯”å¦‚è¯´ `0 & 0 = 0`ã€`0 & 1 = 1`ã€`1 & 0 = 1`ã€`1 & 1 = 1`ã€‚

`>>` çš„ä½œç”¨å·¦è¾¹æ•°æ®çš„æ•°æ®ç§»åŠ¨å³è¾¹æ•°æ®æŒ‡å®šçš„æ­¥æ•°ï¼Œè€Œ `<<` ä¸å…¶ç”¨æ³•ç±»ä¼¼ã€‚
æ¯”å¦‚è¯´ `010 >> 1 = 001`ã€`100 & 2 = 001`ã€‚

#### å®šä¹‰æ–¹ç¨‹

æˆ‘ä»¬æ¥å®šä¹‰ä¸€ä¸ªæ–¹ç¨‹ $dp[i][s_i][k_i]$ï¼Œ
å…¶ä¸­
- $i$ _(index)_ æ˜¯è¡Œçš„åºåˆ—æ•°/ç´¢å¼•
- $s_i$ _(state)_ æ˜¯è¡Œçš„çŠ¶æ€
- $k_i$ _(king counts)_ æ˜¯æ­¤è¡Œæ”¾ç½®äº†çš„å›½ç‹æ•°é‡

å¯¹äº $s_i$ï¼Œå…¶å€¼ä½¿ç”¨äºŒè¿›åˆ¶æ¥è¡¨ç¤ºã€‚
æ¯”å¦‚æˆ‘ç°åœ¨æœ‰ä¸€ä¸ª ${3}\times{3}$ æ£‹ç›˜ _(å…¶ä¸­ä¸€ç§æƒ…å†µ)_ï¼š

|       | **1** | **2** | **3** |
|-------|-------|-------|-------|
| **1** | ğŸ‘‘    |       | ğŸ‘‘    |
| **2** |       |       |       |
| **3** |       | ğŸ‘‘    |       |

æˆ‘ä»¬æŒ‰ç…§å®šä¹‰æ¥ç”¨è¡¨æ ¼è¡¨ç¤ºè¿™ä¸ªæ–¹ç¨‹ï¼š

| $i$     | $s_i$ | $k_i$     | $dp[i][s_i][k_i]$ |
|---------|-------|-----------|-------------------|
| $1$     | `000` | $0$       | $1$               |
| $1$     | `010` | $1$       | $1$               |
| $1$     | `101` | $2$       | $1$               |
| $2$     | `000` | $1$ æˆ– $2$ | $2$               |
| $2$     | `010` | $1$       | $1$               |
| $2$     | `101` | $2$       | $1$               |
| $\dots$ | `...` | $\dots$   | $\dots$           |

#### æ¨å¯¼æ–¹ç¨‹

ä¸ºäº†æ–¹ä¾¿è¡¨ç¤ºçš‡å† å››å‘¨æ²¡æœ‰æ›´å¤šçš„çš‡å† ï¼Œæˆ‘ä»¬ç”¨ä¸€ä¸ªé›†åˆ $S$ åŒ…å«æ‰€æœ‰å¯èƒ½çš„ $s_i$ï¼š
$$
S=\left\{
0\le{s_i}<{2^N}, \\
{s_i}\&({s_i}\ll{1})=0
\right\}
$$
æœ¬è´¨ä¸Šå°±æ˜¯ä¸¤ä¸ªæ¡ä»¶ï¼š
- $0\le{s_i}<{2^N}$ï¼šçŠ¶æ€ç çš„é•¿åº¦ä¸å¯èƒ½è¶…è¿‡ $N$ï¼Œå¦åˆ™æ²¡æœ‰æ„ä¹‰ã€‚
- åœ¨ ${s_i}\&({s_i}\ll{1})=0$ ä¸­
  - ${s_i}\ll{1}$ _(å‡è®¾ä¸º ${s_{i}}'$)_ å°†æ‰€æœ‰çš‡å† å·¦ç§»äº† 1 å•ä½é•¿åº¦ï¼Œ
  - ${s_i}\&{s_{i}}'$ ä¸­ï¼Œè‹¥çš‡å† é—´åªæœ‰ 1 å•ä½é•¿åº¦ï¼Œ${s_{i}}'$ åœ¨å’Œä½è¿ç®—æ—¶ä¼šå°†ä¸ç©ºä½å¯¹åº”ï¼Œé‚£ä¹ˆä½è¿ç®—å®Œæˆåï¼Œæ¯ä¸€ä½éƒ½åº”å½“ä¸º $0$ã€‚

æˆ‘ä»¬å…ˆä»ç¬¬ $1$ è¡Œå¼€å§‹çœ‹èµ·ï¼Œä¸éš¾å‘ç°ï¼Œç¬¬ä¸€è¡Œçš„æ‘†æ”¾ä¸å—å…¶å®ƒè¡Œçš„å½±å“ï¼Œ
åŒæ—¶ï¼Œåªè¦æˆ‘ä»¬ç¡®ä¿å…¶æ‘†æ”¾çš„åˆè§„çš„ï¼Œé‚£ä¹ˆå…¶çŠ¶æ€è½¬ç§»æ–¹ç¨‹åº”ä¸ºï¼š
$$
dp[0][s_0][k_0] = 1
$$

è€ƒè™‘åˆ°ä¸Šé¢çš„çš‡å† å¯èƒ½æ”¶åˆ°ä¸‹é¢çš‡å† çš„æ”»å‡»ï¼Œå³çš‡å† ä¸Šæ–¹çš„å·¦è¾¹ã€ä¸­é—´ã€å³è¾¹éƒ½ä¸èƒ½æœ‰çš‡å† ã€‚
æ•´è¡Œè¢«æ”¾æ»¡çš‡å† çš„æ£‹ç›˜å¯ä»¥è¡¨ç¤ºä¸º ${1}\ll{N})-{1}$ï¼Œå³å½“ $N=3$ï¼Œå…¶ç»“æœå°±ä¸º `111`ã€‚
æ¥ç€ï¼Œæˆ‘ä»¬åœ¨çš‡å† å‘¨å›´æ¡†å‡ºä¸€ä¸ªæ°´å¹³åŒºåŸŸ ${s_i}|{s_i}\ll{1}|{s_i}\gg{1}$ï¼Œ
åˆåœ¨ä¸€èµ·ï¼Œ${({s_i}|{s_i}\ll{1}|{s_i}\gg{1})}\&{({1}\ll{N})-{1})}$ ï¼Œé‚£ä¹ˆå°±é€‰æ‹©å‡ºæ¥äº†çš‡å† ä¸èƒ½æ”¾ç½®çš„åŒºåŸŸã€‚
å†ä¸ $s_{i-1}$ å’Œä½è¿ç®—ï¼Œç†æƒ³ä¸­åº”è¯¥ä¸º $0$ã€‚
å› è€Œ $s_i$ ä¸ $s_{i-1}$ è¦ç¬¦åˆ ${s_{i-1}}\&{({({s_i}|{s_i}\ll{1}|{s_i}\gg{1})}\&{({1}\ll{N})-{1})})}=0$ã€‚

æ­¤åçš„ç¬¬ $i$ è¡Œçš„çŠ¶æ€è½¬ç§»æ–¹ç¨‹éƒ½ä¸ºï¼š
$$
dp[i][s_i][k_i] = {
\left\{
    \begin{matrix}
    \sum\limits_{{s_{i-1}}\in{S},{s_{i-1}}\&{({({s_i}|{s_i}\ll{1}|{s_i}\gg{1})}\&{({1}\ll{N})-{1})})}=0}^{} dp[i-1][s_{i-1}][k_{s_{i-1}}-k_i], \\
    0
    \end{matrix}\right.
}
$$

> ä¸ºä»€ä¹ˆæ˜¯ $k_{s_{i-1}}$ ï¼Ÿ
> å…¶å«ä¹‰ä¸ºæ­¤æ—¶ç¬¬ $i-1$ è¡Œä¸­ç¬¦åˆé¢˜ç›®æ¡ä»¶ _(å³çš‡å† å››å‘¨ä¸èƒ½æœ‰çš‡å† )_ çš„çŠ¶æ€ä¸‹ï¼Œé‚£ä¸ªçŠ¶æ€çš„ $k$ çš„å€¼ï¼Œä¹Ÿå°±æ˜¯çš‡å† æ•°é‡ã€‚

> åŒæ—¶ï¼Œ$\sum\limits_{{s_{i-1}}\in{S},{s_{i-1}}\&{({({s_i}|{s_i}\ll{1}|{s_i}\gg{1})}\&{({1}\ll{N})-{1})})}=0}^{} dp[i-1][s_{i-1}][k_{s_{i-1}}-k_i]$ ä¹Ÿå¾ˆå¥½ç†è§£ã€‚
> $dp[i-1][s_{i-1}][k_{s_{i-1}}-k_i]$ å³ç¬¬ $i-1$ è¡Œåœ¨ $s_{i-1}$ çŠ¶æ€ä¸‹ _(è¯¥å€¼ä¸å”¯ä¸€)_ æ–¹æ¡ˆæ•°é‡ã€‚
> é‚£ä¹ˆ $\sum\limits_{{s_{i-1}}\in{S},{s_{i-1}}\&{({({s_i}|{s_i}\ll{1}|{s_i}\gg{1})}\&{({1}\ll{N})-{1})})}=0}^{} dp[i-1][s_{i-1}][k_{s_{i-1}}-k_i]$ ä¸ç¬¬ $i$ã€$i-1$ è¡Œæ‰€æœ‰ç¬¦åˆé¢˜æ„çš„æ–¹æ¡ˆä¹‹å’Œã€‚

å› è€Œï¼Œæ€»æ–¹æ¡ˆæ•°åº”ä¸ºï¼š
$$
\text{æ€»æ–¹æ¡ˆæ•°}=\sum_{{s_{N-1}}\in{S}} dp[N-1][s_{N-1}][K]
$$

<Tabs>
  <TabItem value="cpp" label="C++" default>

```cpp showLineNumbers
#include <iostream>
#include <vector>
#include <map>
#include <algorithm>
using namespace std;

int main() {
    int N, K;
    cin >> N >> K;

    const int full_mask = (1 << N) - 1;

    vector<int> state_list;
    for (int s = 0; s <= full_mask; s++) {
        // æ£€æŸ¥è¡Œå†…æ˜¯å¦æœ‰ç›¸é‚»å›½ç‹ï¼š(s & (s << 1)) == 0
        if ((s & (s << 1)) == 0) {
            state_list.push_back(s);
        }
    }
    int num_states = state_list.size();  // æœ‰æ•ˆçŠ¶æ€æ•°é‡

    vector<int> state_count(num_states);    // æ¯ä¸ªçŠ¶æ€çš„å›½ç‹æ•°
    vector<int> forbid_mask(num_states);    // æ¯ä¸ªçŠ¶æ€çš„ç¦ç”¨æ‰‹ç 
    
    for (int i = 0; i < num_states; i++) {
        int s = state_list[i];
        state_count[i] = __builtin_popcount(s);
        forbid_mask[i] = (s | (s << 1) | (s >> 1)) & full_mask;
    }

    vector<vector<int>> compatible(num_states);
    for (int i = 0; i < num_states; i++) {
        for (int j = 0; j < num_states; j++) {
            // æ£€æŸ¥çŠ¶æ€å…¼å®¹æ€§ï¼št & P(s) == 0
            if ((state_list[j] & forbid_mask[i]) == 0) {
                compatible[i].push_back(j);  // jçŠ¶æ€æ˜¯içŠ¶æ€çš„å…¼å®¹ä¸Šä¸€è¡ŒçŠ¶æ€
            }
        }
    }

    // dp[i][k] = æ–¹æ¡ˆæ•°ï¼Œå…¶ä¸­iæ˜¯çŠ¶æ€ç´¢å¼•ï¼Œkæ˜¯å›½ç‹æ€»æ•°
    vector<vector<long long>> dp(num_states, vector<long long>(K + 1, 0));
    
    // åˆå§‹åŒ–ç¬¬ä¸€è¡Œ
    for (int i = 0; i < num_states; i++) {
        int cnt = state_count[i];
        if (cnt <= K) {
            dp[i][cnt] = 1;  // æœ‰æ•ˆçŠ¶æ€è®¾ç½®æ–¹æ¡ˆæ•°ä¸º1
        }
    }

    for (int row = 1; row < N; row++) {
        // åˆ›å»ºæ–°DPè¡¨
        vector<vector<long long>> new_dp(num_states, vector<long long>(K + 1, 0));
        
        for (int cur_idx = 0; cur_idx < num_states; cur_idx++) {
            int cur_count = state_count[cur_idx];  // å½“å‰è¡Œå›½ç‹æ•°
            
            for (int total_k = cur_count; total_k <= K; total_k++) {
                // è®¡ç®—å‰ä¸€è¡Œçš„å›½ç‹æ•°
                int prev_k = total_k - cur_count;
                
                // éå†æ‰€æœ‰å…¼å®¹çš„ä¸Šä¸€è¡ŒçŠ¶æ€
                for (int prev_idx : compatible[cur_idx]) {
                    if (prev_k >= 0) {
                        new_dp[cur_idx][total_k] += dp[prev_idx][prev_k];
                    }
                }
            }
        }
        
        dp = move(new_dp);  // æ›´æ–°DPè¡¨
    }

    long long ans = 0;
    for (int i = 0; i < num_states; i++) {
        ans += dp[i][K];  // ç´¯åŠ æ‰€æœ‰çŠ¶æ€ä¸­æ”¾ç½®Kä¸ªå›½ç‹çš„æ–¹æ¡ˆ
    }
    
    cout << ans << endl;

    return 0;
}
```

  </TabItem>
</Tabs>